(this["webpackJsonpseahub-frontend"]=this["webpackJsonpseahub-frontend"]||[]).push([[6],{1108:function(e,t,a){e.exports=a(1275)},1275:function(e,t,a){"use strict";a.r(t);var n=a(5),i=a(6),r=a(8),o=a(7),s=a(0),d=a.n(s),c=a(23),l=a.n(c),f=a(46),h=a.n(f),u=a(1),m=a(4),p=a(42),v=a(54),g=a(79),b=a(14),y=a(12),I=a.n(y),k=a(3),w=a(73);I.a.locale(window.app.config.lang);var E=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).onMouseEnter=function(){i.props.isItemFreezed||i.setState({isShowOperationIcon:!0})},i.onMouseLeave=function(){i.props.isItemFreezed||i.setState({isShowOperationIcon:!1})},i.onToggleClick=function(e){i.setState({isMenuShow:!i.state.isMenuShow}),i.props.onFreezedItemToggle()},i.onItemClick=function(){if(i.setState({isShowOperationIcon:!1}),i.props.item.commit_id!==i.props.currentItem.commit_id){var e=i.props.index;i.props.onItemClick(i.props.item,e)}},i.onItemRestore=function(){i.props.onItemRestore(i.props.currentItem)},i.onItemDownload=function(){},i.state={isShowOperationIcon:!1,isMenuShow:!1},i}return Object(i.a)(a,[{key:"render",value:function(){if(!this.props.currentItem)return"";var e=this.props.item,t=I()(e.ctime).format("YYYY-MM-DD HH:mm"),a=!1;this.props.item&&this.props.currentItem&&(a=this.props.item.commit_id===this.props.currentItem.commit_id);var n=this.props.currentItem.rev_file_id,i=w.a.getUrl({type:"download_historic_file",filePath:u.ib,objID:n});return d.a.createElement("li",{className:"history-list-item ".concat(a?"item-active":""),onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onClick:this.onItemClick},d.a.createElement("div",{className:"history-info"},d.a.createElement("div",{className:"time"},t),d.a.createElement("div",{className:"owner"},d.a.createElement("span",{className:"squire-icon"}),d.a.createElement("span",null,e.creator_name))),d.a.createElement("div",{className:"history-operation"},d.a.createElement(k.l,{isOpen:this.state.isMenuShow,toggle:this.onToggleClick},d.a.createElement(k.o,{tag:"a",className:"fas fa-ellipsis-v ".concat(this.state.isShowOperationIcon||a?"":"invisible"),"data-toggle":"dropdown","aria-expanded":this.state.isMenuShow,alt:Object(u.mb)("More Operations")}),d.a.createElement(k.n,null,0!==this.props.index&&d.a.createElement(k.m,{onClick:this.onItemRestore},Object(u.mb)("Restore")),d.a.createElement(k.m,{tag:"a",href:i,onClick:this.onItemDownLoad},Object(u.mb)("Download"))))))}}]),a}(d.a.Component),C=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).componentDidMount=function(){var e=i.props.historyList;e.length>0&&(i.setState({currentItem:e[0]}),1===e?i.props.onItemClick(e[0]):i.props.onItemClick(e[0],e[1]))},i.onFreezedItemToggle=function(){i.setState({isItemFreezed:!i.state.isItemFreezed})},i.onScrollHandler=function(e){var t=e.target.clientHeight,a=e.target.scrollHeight,n=t+e.target.scrollTop+1>=a,r=i.props.hasMore;n&&r&&i.props.reloadMore()},i.onItemClick=function(e,t){if(i.setState({currentItem:e}),t!==i.props.historyList.length){var a=i.props.historyList[t+1];i.props.onItemClick(e,a)}else i.props.onItemClick(e)},i.state={isItemFreezed:!1,currentItem:null},i}return Object(i.a)(a,[{key:"render",value:function(){var e=this;return d.a.createElement("ul",{className:"history-list-container",onScroll:this.onScrollHandler},this.props.historyList.map((function(t,a){return d.a.createElement(E,{key:a,item:t,index:a,currentItem:e.state.currentItem,isItemFreezed:e.state.isItemFreezed,onItemClick:e.onItemClick,onItemRestore:e.props.onItemRestore,onFreezedItemToggle:e.onFreezedItemToggle})})),this.props.isReloadingData&&d.a.createElement("li",null,d.a.createElement(b.a,null)))}}]),a}(d.a.Component),O=a(10),D=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).reloadMore=function(){if(!i.state.isReloadingData){var e=i.state.currentPage+1;i.setState({currentPage:e,isReloadingData:!0}),g.a.listFileHistoryRecords(u.ib,e,u.a).then((function(e){i.updateResultState(e.data),i.setState({isReloadingData:!1})}))}},i.onItemRestore=function(e){var t=e.commit_id;g.a.revertFile(u.ib,t).then((function(e){e.data.success&&(i.setState({isLoading:!0}),i.refershFileList());var t=Object(u.mb)("Successfully restored.");O.a.success(t)}))},i.onItemClick=function(e,t){i.props.onItemClick(e,t)},i.state={historyInfo:"",currentPage:1,hasMore:!1,isLoading:!0,isError:!1,fileOwner:"",isReloadingData:!1},i}return Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=this;g.a.listFileHistoryRecords(u.ib,1,u.a).then((function(t){if(0===t.data.length)throw e.setState({isLoading:!1}),Error("there has an error in server");e.initResultState(t.data)}))}},{key:"refershFileList",value:function(){var e=this;g.a.listFileHistoryRecords(u.ib,1,u.a).then((function(t){e.initResultState(t.data)}))}},{key:"initResultState",value:function(e){e.data.length&&this.setState({historyInfo:e.data,currentPage:e.page,hasMore:e.total_count>u.a*this.state.currentPage,isLoading:!1,isError:!1,fileOwner:e.data[0].creator_email})}},{key:"updateResultState",value:function(e){e.data.length&&this.setState({historyInfo:[].concat(Object(v.a)(this.state.historyInfo),Object(v.a)(e.data)),currentPage:e.page,hasMore:e.total_count>u.a*this.state.currentPage,isLoading:!1,isError:!1,fileOwner:e.data[0].creator_email})}},{key:"render",value:function(){return d.a.createElement("div",{className:"side-panel history-side-panel"},d.a.createElement("div",{className:"side-panel-center"},d.a.createElement("div",{className:"history-side-panel-title"},Object(u.mb)("History Versions")),d.a.createElement("div",{className:"history-body"},this.state.isLoading&&d.a.createElement(b.a,null),this.state.historyInfo&&d.a.createElement(C,{hasMore:this.state.hasMore,isReloadingData:this.state.isReloadingData,historyList:this.state.historyInfo,reloadMore:this.reloadMore,onItemClick:this.onItemClick,onItemRestore:this.onItemRestore}))))}}]),a}(d.a.Component),j=a(111),_=a.n(j),x=a(197);a(205);var M=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(){var e;Object(n.a)(this,a);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).onSearchedClick=function(){},e}return Object(i.a)(a,[{key:"componentDidMount",value:function(){_.a.highlightAll()}},{key:"render",value:function(){return d.a.createElement("div",{className:"main-panel"},d.a.createElement("div",{className:"main-panel-center content-viewer"},d.a.createElement("div",{className:"markdown-viewer-render-content"},this.props.renderingContent?d.a.createElement(b.a,null):d.a.createElement("div",{className:"diff-view article"},d.a.createElement(x.a,{newMarkdownContent:this.props.newMarkdownContent,oldMarkdownContent:this.props.oldMarkdownContent})))))}}]),a}(d.a.Component),S=a(9),F=(a(135),a(399),a(93),a(106),function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).onSearchedClick=function(e){m.a.handleSearchedItemClick(e)},i.setDiffContent=function(e,t){i.setState({renderingContent:!1,newMarkdownContent:e,oldMarkdownContent:t})},i.onHistoryItemClick=function(e,t){i.setState({renderingContent:!0}),t?h.a.all([S.a.getFileRevision(u.pb,e.commit_id,e.path),S.a.getFileRevision(u.pb,t.commit_id,t.path)]).then(h.a.spread((function(e,t){h.a.all([S.a.getFileContent(e.data),S.a.getFileContent(t.data)]).then(h.a.spread((function(e,t){i.setDiffContent(e.data,t.data)})))}))):S.a.getFileRevision(u.pb,e.commit_id,e.path).then((function(e){h.a.all([S.a.getFileContent(e.data)]).then(h.a.spread((function(e){i.setDiffContent(e.data,"")})))}))},i.state={renderingContent:!0,newMarkdownContent:"",oldMarkdownContent:""},i}return Object(i.a)(a,[{key:"render",value:function(){return d.a.createElement(s.Fragment,null,d.a.createElement("div",{id:"header",className:"history-header"},d.a.createElement("div",{className:"title"},d.a.createElement("a",{href:"javascript:window.history.back()",className:"go-back",title:"Back"},d.a.createElement("span",{className:"fas fa-chevron-left"})),d.a.createElement("span",{className:"name"},u.hb)),d.a.createElement("div",{className:"toolbar"},d.a.createElement(p.a,{onSearchedClick:this.onSearchedClick}))),d.a.createElement("div",{id:"main",className:"history-content"},d.a.createElement(M,{newMarkdownContent:this.state.newMarkdownContent,oldMarkdownContent:this.state.oldMarkdownContent,renderingContent:this.state.renderingContent}),d.a.createElement(D,{onItemClick:this.onHistoryItemClick})))}}]),a}(d.a.Component));l.a.render(d.a.createElement(F,null),document.getElementById("wrapper"))},197:function(e,t,a){"use strict";var n=a(15),i=a(18),r=a(20),o=a(21),s=a(22),d=a(0),c=a.n(d),l=a(86),f=a(35),h=a(81),u=a.n(h);function m(e,t){if(!e.length&&!t.length)return 1;if(!e.length||!t.length)return 0;if(e.toUpperCase()===t.toUpperCase())return 1;if(1===e.length&&1===t.length)return 0;var a=g(e),n=g(t),i=a.length+n.length,r=0;return a.forEach((function(e){for(var t,a=0;t=n[a];a++)if(e===t){r++,n.splice(a,1);break}})),2*r/i}function p(e){return Array.isArray(e)?e.reduce((function(e,t){return e.concat(p(t))}),[]):[e]}function v(e){for(var t=[],a=0,n=e.length-1;a<n;a++)t[a]=e.substring(a,a+2);return t}function g(e){return p(e.toUpperCase().split(" ").map(v))}var b=a(11),y=a(41);function I(e,t){return e.type===t.type&&(!!u.a.isEqual(e,t)||(b.i.isText(e)&&b.i.isText(t)?m(e.text,t.text)>=.5&&"changed":(e.type===t.type&&(e.type.includes("ordered_list")||e.type.includes("unordered_list"))&&m(b.d.text(e),b.d.text(t))>=.5||e.type===t.type&&(e.children.length>1||t.children.length>1)&&"list_item"===e.type&&m(b.d.text(e),b.d.text(t))>=.5||e.type===t.type&&"paragraph"===e.type&&m(b.d.text(e),b.d.text(t))>=.5||e.type===t.type&&"table"===e.type&&m(b.d.text(e),b.d.text(t))>=.5||e.type===t.type&&"table_row"===e.type||e.type===t.type&&"table_cell"===e.type)&&"changed"))}function k(e,t){return e===t}var w=function(){function e(){var t=this;Object(n.a)(this,e),this.deepDiff=function(e,a,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=[],o=i+1,s=new C({equalFunc:n});s.ArrayDiff(e,a);for(var d=0;d<s.diff.length;d++){var c=s.diff[d],l=c.changeType;if("common"===l){var f={diff_state:"diff-common",new_index:c.newIndex,old_index:-1,node_depth:o};c.item.data=Object.assign(c.item.data?c.item.data:{},f)}else if("added"===l)if(b.i.isText(c.item))c.item.ADD=!0;else{var h={diff_state:"diff-added",new_index:c.newIndex,old_index:-1,node_depth:o};c.item.data=Object.assign(c.item.data?c.item.data:{},h)}else if("removed"===l)if(b.i.isText(c.item))c.item.DELETE=!0;else{var u={diff_state:"diff-removed",new_index:-1,old_index:c.oldIndex,node_depth:o};c.item.data=Object.assign(c.item.data?c.item.data:{},u)}else if("replaced"===l){var m=void 0,p=c.item.type||"text";if("text"===p?m=t.getTextDiff(c.newItem,c.oldItem):(p.includes("ordered_list")||p.includes("unordered_list")||p.includes("list_item")||"table"===p||"table_row"===p||"table_cell"===p||"paragraph"===p)&&(m=t.deepDiff(c.newItem.children,c.oldItem.children,n,o)),b.i.isText(c.item))c.item=m;else{var v={diff_state:"diff-replaced",new_index:-1,old_index:c.oldIndex,node_depth:o};c.item.data=Object.assign(c.item.data?c.item.data:{},v),c.item.children=m}}Array.isArray(c.item)?r=r.concat(c.item):r.push(c.item)}return r},this.getDiffDocument=function(e,a){var n=Object(y.a)(e),i=Object(y.a)(a),r=t.deepDiff(n,i,I);return r=t.splitTopDiffNodes(r)}}return Object(i.a)(e,[{key:"getTextDiff",value:function(e,t){var a=[],n=this.textDiff(e.text,t.text);return a=a.concat(n)}},{key:"textDiff",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=[],i=new C({equalFunc:k});i.StringDiff(e,t);var r=i.diff,o="",s=r[0].changeType;return r.forEach((function(e,t,i){var r="";"removed"===s?r="DELETE":"added"===s&&(r="ADD"),s===e.changeType?(o+=e.item,t===i.length-1&&n.push(Object(f.a)(Object(l.a)({text:o},r,!0),a))):e.changeType!==s&&(n.push(Object(f.a)(Object(f.a)({text:o},a),{},Object(l.a)({},r,!0))),s=e.changeType,o=e.item,t===i.length-1&&("removed"===s?r="DELETE":"added"===s&&(r="ADD"),n.push(Object(f.a)(Object(l.a)({text:o},r,!0),a))))})),n}},{key:"splitDiffParagraph",value:function(e){var t=u.a.cloneDeep(e),a=u.a.cloneDeep(e),n=[],i=[];return e.children.forEach((function(e,t,a){"link"===e.type||"image"===e.type?"diff-added"===e.data.diff_state?n.push(e):("diff-removed"===e.data.diff_state||n.push(e),i.push(e)):e.ADD?n.push(e):(e.DELETE||n.push(e),i.push(e))})),t.children=n,a.data.paragraph_state="old-paragraph",t.data.paragraph_state="new-paragraph",a.children=i,[a,t]}},{key:"splitTopDiffNodes",value:function(e){var t=this,a=[];return e.forEach((function(e){if("diff-replaced"===e.data.diff_state&&"paragraph"===e.type){var n=t.splitDiffParagraph(e);a.push(n[0],n[1])}else"diff-replaced"===e.data.diff_state&&"table"===e.type?(t.splitTableDiffParagraph(e),a.push(e)):a.push(e)})),a}},{key:"splitTableDiffParagraph",value:function(e){var t=this;return e.children.forEach((function(e,a,n){"diff-replaced"===e.data.diff_state&&e.children.forEach((function(e){if("diff-replaced"===e.data.diff_state&&"diff-replaced"===e.children[0].data.diff_state){var a=t.splitDiffParagraph(e.children[0]);e.children=a}}))})),e}}]),e}(),E=function(){function e(t,a,i){Object(n.a)(this,e),this.item=t,this.newIndex=a,this.oldIndex=i}return Object(i.a)(e,[{key:"added",value:function(){return void 0===this.oldIndex}},{key:"removed",value:function(){return void 0===this.newIndex}},{key:"common",value:function(){return void 0!==this.oldIndex&&void 0!==this.newIndex}}]),e}(),C=function(){function e(t){Object(n.a)(this,e),this.equalFunc=t.equalFunc?t.equalFunc:k,void 0!=t.shouldDetectChange?this.shouldDetectChange=t.shouldDetectChange:this.shouldDetectChange=!1,this.similarityFunc=t.similarityFunc}return Object(i.a)(e,[{key:"addAdded",value:function(e,t){var a=new E(e,t,void 0);a.changeType="added",this.added.push(a),this.diff.push(a)}},{key:"addRemoved",value:function(e,t){var a=new E(e,void 0,t);this.removed.push(a),a.changeType="removed",this.diff.push(a)}},{key:"addReplaced",value:function(e,t,a,n){var i=new E(e,n,a);i.newItem=t,i.oldItem=e,i.changeType="replaced",this.replaced.push(i),this.diff.push(i)}},{key:"addCommon",value:function(e,t,a,n){var i=new E(e,n,a);i.newItem=t,i.changeType="common",i.oldItem=e,this.common.push(i),this.diff.push(i)}},{key:"StringDiff",value:function(e,t){var a=e.length,n=t.length,i=0,r=0,o=[];for(o[a]=[],r=n;r>=0;o[a][r--]=0);for(i=a-1;i>=0;i--)for(o[i]=[],o[i][n]=0,r=n-1;r>=0;r--)this.equalFunc(e[i],t[r])?o[i][r]=o[i+1][r+1]+1:o[i][r]=Math.max(o[i+1][r],o[i][r+1]);for(this.common=[],this.added=[],this.removed=[],this.replaced=[],this.diff=[],i=r=0;i<a&&r<n;){if(this.equalFunc(e[i],t[r])){var s=e[i],d=t[r];this.addCommon(d,s,r,i),i++,r++}else o[i+1][r]>=o[i][r+1]?(this.addAdded(e[i],i),i++):(this.addRemoved(t[r],r),r++)}for(;i<a;i++)this.addAdded(e[i],i);for(;r<n;r++)this.addRemoved(t[r],r)}},{key:"ArrayDiff",value:function(e,t,a){var n=e.length,i=t.length,r=0,o=0,s=[];for(s[n]=[],o=i;o>=0;s[n][o--]=0);for(r=n-1;r>=0;r--)for(s[r]=[],s[r][i]=0,o=i-1;o>=0;o--)this.equalFunc(e[r],t[o])?s[r][o]=s[r+1][o+1]+1:s[r][o]=Math.max(s[r+1][o],s[r][o+1]);for(this.common=[],this.added=[],this.removed=[],this.replaced=[],this.diff=[],r=o=0;r<n&&o<i;){var d=this.equalFunc(e[r],t[o]);if(d){var c=e[r],l=t[o];"changed"===d?this.addReplaced(l,c,o,r):this.addCommon(l,c,o,r),a&&a("C",o,r),r++,o++}else s[r+1][o]>=s[r][o+1]?(this.addAdded(e[r],r),a&&a("A",0,r),r++):(this.addRemoved(t[o],o),a&&a("D",o,0),o++)}for(;r<n;r++)this.addAdded(e[r],r),a&&a("A",0,r);for(;o<i;o++)this.addRemoved(t[o],o),a&&a("D",o,0)}}]),e}(),O=a(58),D=a(187),j=(a(398),function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(r.a)(this,Object(o.a)(t).call(this,e))).renderDiffNode=function(e){var t=e.element,a=t.data?t.data:{},n=a.diff_state,i=a.node_depth;return"diff-added"===n?i>1?"blockquote"===t.type||"code_block"===t.type?c.a.createElement("div",{className:"diff-added-container"},Object(O.b)(e)):Object(O.b)(e):c.a.createElement("div",{className:"diff-added"},Object(O.b)(e)):"diff-removed"===n?i>1?"blockquote"===t.type||"code_block"===t.type?c.a.createElement("div",{className:"diff-removed-container"},Object(O.b)(e)):Object(O.b)(e):c.a.createElement("div",{className:"diff-removed"},Object(O.b)(e)):"diff-replaced"===n?i>1?Object(O.b)(e):c.a.createElement("div",{className:"diff-replaced"},Object(O.b)(e)):Object(O.b)(e)},a.value=[],a.slateDiff=new w,a}return Object(s.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props.newMarkdownContent,t=this.props.oldMarkdownContent;return this.value=this.slateDiff.getDiffDocument(e,t),c.a.createElement(D.a,{style:{width:"100%"},renderDiffElement:this.renderDiffNode,renderDiffLeaf:O.a,value:this.value})}}]),t}(c.a.PureComponent));t.a=j},398:function(e,t,a){},399:function(e,t,a){}},[[1108,1,0]]]);
//# sourceMappingURL=fileHistory.chunk.js.map