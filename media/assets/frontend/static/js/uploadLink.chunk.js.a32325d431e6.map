{"version":3,"sources":["pages/upload-link/upload-list-item.js","pages/upload-link/forbid-upload-list-item.js","pages/upload-link/upload-progress-dialog.js","pages/upload-link/file-uploader.js","pages/upload-link/index.js"],"names":["UPLOAD_UPLOADING","UPLOAD_ERROR","UPLOAD_ISSAVING","UPLOAD_UPLOADED","UploadListItem","props","onUploadCancel","e","preventDefault","resumableFile","onUploadRetry","formatFileSize","size","toFixed","state","uploadState","nextProps","error","remainingTime","isSaved","this","setState","progress","Math","round","className","newFileName","isUploading","role","style","width","aria-valuenow","aria-valuemin","aria-valuemax","gettext","Utils","formatTime","dangerouslySetInnerHTML","__html","href","onClick","React","Component","ForbidUploadListItem","file","msg","replace","maxUploadFileSize","name","colSpan","UploadProgressDialog","toggleDropdown","dropdownOpen","allFilesUploaded","isOpen","toggle","color","caret","onFileUpload","onFolderUpload","outline","onCancelAllUploading","disabled","forbidUploadFileList","map","index","key","uploadFileList","FileUploader","componentWillUnmount","window","onbeforeunload","dragAndDrop","resumable","disableDropOnDocument","uploader","isUploadProgressDialogShow","totalProgress","bindCallbackHandler","minFileSizeErrorCallback","fileTypeErrorCallback","maxFilesErrorCallback","opts","maxFileSizeErrorCallback","bindEventHandler","on","onChunkingComplete","bind","onFileAdded","onFileProgress","onFileUploadSuccess","onProgress","onComplete","onFileError","onError","onDragStart","files","errorCount","maxFiles","maxNumberOfFilesForFileupload","message","toaster","danger","push","path","fileName","relativePath","isFile","formData","parent_dir","relative_path","slice","lastIndexOf","length","setUploadFileList","seafileAPI","sharedUploadLinkGetFileUploadUrl","token","then","res","target","data","upload_link","resumableUpload","catch","errMessage","getErrorMsg","isUploadLinkLoaded","upload","repoID","getFileUploadedBytes","uploadedBytes","blockSize","parseInt","resumableUploadFileBlockSize","offset","floor","markChunksCompleted","filesAddedComplete","registerGlobalVariable","uploadBitrate","getBitrate","item","uniqueIdentifier","lastSize","time","loaded","now","Date","getTime","forEach","timestamp","timeDiff","bitrateInterval","currentTime","JSON","parse","dir_name","indexOf","dirent","id","type","mtime","notifiedFolders","some","errorMessage","retryFileList","setHeaders","chunkSize","getOpt","fileSize","startByte","endByte","min","encodeURI","setQuery","generateUniqueIdentifier","webkitRelativePath","MD5","nativeEvent","stopImmediatePropagation","stopPropagation","uploadInput","current","removeAttribute","click","setAttribute","onCloseUploadDialog","uploadingItem","filter","cancel","retryUploadFile","bootstrap","firedRetry","resumableObj","replaceRepetitionFile","getUpdateLink","cancelFileUpload","pop","currentResumableFile","createRef","Resumablejs","query","fileType","filetypes","undefined","maxFileSize","testMethod","testChunks","headers","withCredentials","simultaneousUploads","fileParameterName","forceChunkSize","maxChunkRetries","minFileSize","assignBrowse","assignDrop","document","getElementById","ref","loggedUser","app","pageOptions","username","uploadLink","dirName","sharedBy","noQuota","SharedUploadLink","HTMLescape","avatar","ReactDOM","render"],"mappings":"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","file":"static/js/uploadLink.chunk.js","sourcesContent":["import React, { Fragment } from 'react';\nimport PropTypes from 'prop-types';\nimport { gettext } from '../../utils/constants';\nimport { Utils } from '../../utils/utils';\n\nconst propTypes = {\n  resumableFile: PropTypes.object.isRequired,\n  onUploadCancel: PropTypes.func.isRequired,\n  onUploadRetry: PropTypes.func.isRequired,\n};\n\nconst UPLOAD_UPLOADING = 'uploading';\nconst UPLOAD_ERROR = 'error';\nconst UPLOAD_ISSAVING = 'isSaving';\nconst UPLOAD_UPLOADED = 'uploaded';\n\nclass UploadListItem extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      uploadState: UPLOAD_UPLOADING\n    };\n  }\n\n  componentWillReceiveProps(nextProps) {\n    let { resumableFile } = nextProps;\n    let uploadState = UPLOAD_UPLOADING;\n\n    if (resumableFile.error) {\n      uploadState = UPLOAD_ERROR;\n    } else {\n      if (resumableFile.remainingTime === 0 && !resumableFile.isSaved) {\n        uploadState = UPLOAD_ISSAVING;\n      }\n\n      if (resumableFile.isSaved) {\n        uploadState = UPLOAD_UPLOADED;\n      }\n    }\n\n    this.setState({uploadState: uploadState});\n  }\n\n  onUploadCancel = (e) => {\n    e.preventDefault();\n    this.props.onUploadCancel(this.props.resumableFile);\n  }\n\n  onUploadRetry = (e) => {\n    e.preventDefault();\n    this.props.onUploadRetry(this.props.resumableFile);\n  }\n\n  formatFileSize = (size) => {\n    if (typeof size !== 'number') {\n      return '';\n    }\n    if (size >= 1000 * 1000 * 1000) {\n      return (size / (1000 * 1000 * 1000)).toFixed(1) + ' G';\n    }\n    if (size >= 1000 * 1000) {\n      return (size / (1000 * 1000)).toFixed(1) + ' M';\n    }\n    if (size >= 1000) {\n      return (size / 1000).toFixed(1) + ' K';\n    }\n    return size.toFixed(1) + ' B';\n  }\n\n  render() {\n    let { resumableFile } = this.props;\n    let progress = Math.round(resumableFile.progress() * 100);\n    let error = resumableFile.error;\n\n    return (\n      <tr className=\"file-upload-item\">\n        <td className=\"upload-name\">\n          <div className=\"ellipsis\">{resumableFile.newFileName}</div>\n        </td>\n        <td>\n          <span className=\"file-size\">{this.formatFileSize(resumableFile.size)}</span>\n        </td>\n        <td className=\"upload-progress\">\n          {(this.state.uploadState === UPLOAD_UPLOADING || this.state.uploadState === UPLOAD_ISSAVING) &&\n            <Fragment>\n              {resumableFile.size >= (100 * 1000 * 1000) &&\n                <Fragment>\n                  {resumableFile.isUploading() && (\n                    <div className=\"progress-container\">\n                      <div className=\"progress\">\n                        <div className=\"progress-bar\" role=\"progressbar\" style={{width: `${progress}%`}} aria-valuenow={progress} aria-valuemin=\"0\" aria-valuemax=\"100\"></div>\n                      </div>\n                      {(resumableFile.remainingTime === -1) && <div className=\"progress-text\">{gettext('Preparing to upload...')}</div>}\n                      {(resumableFile.remainingTime > 0) && <div className=\"progress-text\">{gettext('Remaining')}{' '}{Utils.formatTime(resumableFile.remainingTime)}</div>}\n                      {(resumableFile.remainingTime === 0) && <div className=\"progress-text\">{gettext('Indexing...')}</div>}\n                    </div>\n                  )}\n                  {!resumableFile.isUploading() && (\n                    <div className=\"progress-container d-flex align-items-center\">\n                      <div className=\"progress\">\n                        <div className=\"progress-bar\" role=\"progressbar\" style={{width: `${progress}%`}} aria-valuenow={progress} aria-valuemin=\"0\" aria-valuemax=\"100\"></div>\n                      </div>\n                    </div>\n                  )}\n                </Fragment>\n              }\n              {(resumableFile.size < (100 * 1000 * 1000)) &&\n                <div className=\"progress-container d-flex align-items-center\">\n                  <div className=\"progress\">\n                    <div className=\"progress-bar\" role=\"progressbar\" style={{width: `${progress}%`}} aria-valuenow={progress} aria-valuemin=\"0\" aria-valuemax=\"100\"></div>\n                  </div>\n                </div>\n              }\n            </Fragment>\n          }\n          {this.state.uploadState === UPLOAD_ERROR && (\n            <div className=\"message err-message ml-0\" dangerouslySetInnerHTML={{__html: error}}></div>\n          )}\n        </td>\n        <td className=\"upload-operation\">\n          <Fragment>\n            {this.state.uploadState === UPLOAD_UPLOADING && (\n              <a href=\"#\" onClick={this.onUploadCancel}>{gettext('Cancel')}</a>\n            )}\n            {this.state.uploadState === UPLOAD_ERROR && (\n              <a href=\"#\" onClick={this.onUploadRetry}>{gettext('Retry')}</a>\n            )}\n            {this.state.uploadState === UPLOAD_ISSAVING && (\n              <span className=\"saving\">{gettext('Saving...')}</span>\n            )}\n            {this.state.uploadState === UPLOAD_UPLOADED && (\n              <span className=\"uploaded\">{gettext('Uploaded')}</span>\n            )}\n          </Fragment>\n        </td>\n      </tr>\n    );\n  }\n}\n\nUploadListItem.propTypes = propTypes;\n\nexport default UploadListItem;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { gettext, maxUploadFileSize } from '../../utils/constants';\n\nconst propTypes = {\n  file: PropTypes.object,\n};\n\nclass ForbidUploadListItem extends React.Component {\n\n  render() {\n    let { file } = this.props;\n    let msg = gettext('Please upload files less than {placeholder}M').replace('{placeholder}', maxUploadFileSize);\n    return (\n      <tr className=\"file-upload-item\">\n        <td className=\"upload-name\">\n          <div className=\"ellipsis\">{file.name}</div>\n        </td>\n\n        <td colSpan={3} className=\"error\">{msg}</td>\n      </tr>\n    );\n  }\n}\n\nForbidUploadListItem.propTypes = propTypes;\n\nexport default ForbidUploadListItem;\n","import React, { Fragment } from 'react';\nimport PropTypes from 'prop-types';\nimport { Button, ButtonDropdown, DropdownToggle, DropdownMenu, DropdownItem } from 'reactstrap';\nimport { gettext } from '../../utils/constants';\nimport UploadListItem from './upload-list-item';\nimport ForbidUploadListItem from './forbid-upload-list-item';\n\nconst propTypes = {\n  uploadFileList: PropTypes.array.isRequired,\n  forbidUploadFileList: PropTypes.array.isRequired,\n  onCancelAllUploading: PropTypes.func.isRequired,\n  onUploadCancel: PropTypes.func.isRequired,\n  onUploadRetry: PropTypes.func.isRequired,\n  onFileUpload: PropTypes.func.isRequired,\n  onFolderUpload: PropTypes.func.isRequired,\n  allFilesUploaded: PropTypes.bool.isRequired\n};\n\nclass UploadProgressDialog extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      dropdownOpen: false\n    };\n  }\n\n  toggleDropdown = () => {\n    this.setState({\n      dropdownOpen: !this.state.dropdownOpen\n    });\n  }\n\n  render() {\n    let { allFilesUploaded } = this.props;\n    return (\n      <Fragment>\n        <div className=\"text-center\">\n          <ButtonDropdown isOpen={this.state.dropdownOpen} toggle={this.toggleDropdown}>\n            <DropdownToggle color=\"primary\" caret>{gettext('Upload')}</DropdownToggle>\n            <DropdownMenu>\n              <DropdownItem onClick={this.props.onFileUpload}>{gettext('Upload Files')}</DropdownItem>\n              <DropdownItem onClick={this.props.onFolderUpload}>{gettext('Upload Folder')}</DropdownItem>\n            </DropdownMenu>\n          </ButtonDropdown>\n          <Button color=\"primary\" outline={true} className=\"ml-4\"\n            onClick={this.props.onCancelAllUploading}\n            disabled={allFilesUploaded}>\n            {gettext('Cancel All')}\n          </Button>\n        </div>\n        <div className=\"mt-4 mh-2\">\n          <table className=\"table-thead-hidden\">\n            <thead>\n              <tr>\n                <th width=\"35%\">{gettext('name')}</th>\n                <th width=\"15%\">{gettext('size')}</th>\n                <th width=\"35%\">{gettext('progress')}</th>\n                <th width=\"15%\">{gettext('state')}</th>\n              </tr>\n            </thead>\n            <tbody>\n              {this.props.forbidUploadFileList.map((file, index) => {\n                return (<ForbidUploadListItem key={index} file={file} />);\n              })}\n              {this.props.uploadFileList.map((resumableFile, index) => {\n                return (\n                  <UploadListItem\n                    key={index}\n                    resumableFile={resumableFile}\n                    onUploadCancel={this.props.onUploadCancel}\n                    onUploadRetry={this.props.onUploadRetry}\n                  />\n                );\n              })\n              }\n            </tbody>\n          </table>\n        </div>\n      </Fragment>\n    );\n  }\n}\n\nUploadProgressDialog.propTypes = propTypes;\n\nexport default UploadProgressDialog;\n","// This file is copied from frontend/src/components/file-uploader/file-uploader.js,\n// and modified according to the requirements of this page.\nimport React, { Fragment } from 'react';\nimport PropTypes from 'prop-types';\nimport Resumablejs from '@seafile/resumablejs';\nimport MD5 from 'MD5';\nimport { resumableUploadFileBlockSize, maxUploadFileSize, maxNumberOfFilesForFileupload } from '../../utils/constants';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport { Utils } from '../../utils/utils';\nimport { gettext } from '../../utils/constants';\nimport UploadProgressDialog from './upload-progress-dialog';\nimport toaster from '../../components/toast';\n\nimport '../../css/file-uploader.css';\n\nconst propTypes = {\n  dragAndDrop: PropTypes.bool.isRequired,\n  token: PropTypes.string.isRequired,\n  repoID: PropTypes.string.isRequired,\n  path: PropTypes.string.isRequired,\n\n  filetypes: PropTypes.array,\n  chunkSize: PropTypes.number,\n  withCredentials: PropTypes.bool,\n  testMethod: PropTypes.string,\n  testChunks: PropTypes.number,\n  simultaneousUploads: PropTypes.number,\n  fileParameterName: PropTypes.string,\n  minFileSizeErrorCallback: PropTypes.func,\n  fileTypeErrorCallback: PropTypes.func,\n  onFileUploadSuccess: PropTypes.func.isRequired,\n};\n\nclass FileUploader extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      retryFileList: [],\n      uploadFileList: [],\n      forbidUploadFileList: [],\n      totalProgress: 0,\n      isUploadProgressDialogShow: false,\n      currentResumableFile: null,\n      uploadBitrate: 0,\n      allFilesUploaded: false,\n    };\n\n    this.uploadInput = React.createRef();\n\n    this.notifiedFolders = [];\n\n    this.timestamp = null;\n    this.loaded = 0;\n    this.bitrateInterval = 500; // Interval in milliseconds to calculate the bitrate\n    this.isUploadLinkLoaded = false;\n\n    window.onbeforeunload = this.onbeforeunload;\n  }\n\n  componentDidMount() {\n    this.resumable = new Resumablejs({\n      target: '',\n      query: this.setQuery || {},\n      fileType: this.props.filetypes,\n      maxFiles: maxNumberOfFilesForFileupload || undefined,\n      maxFileSize: maxUploadFileSize * 1000 * 1000 || undefined,\n      testMethod: this.props.testMethod || 'post',\n      testChunks: this.props.testChunks || false,\n      headers: this.setHeaders || {},\n      withCredentials: this.props.withCredentials || false,\n      chunkSize: parseInt(resumableUploadFileBlockSize) * 1024 * 1024 || 1 * 1024 * 1024,\n      simultaneousUploads: this.props.simultaneousUploads || 1,\n      fileParameterName: this.props.fileParameterName,\n      generateUniqueIdentifier: this.generateUniqueIdentifier,\n      forceChunkSize: true,\n      maxChunkRetries: 3,\n      minFileSize: 0,\n    });\n\n    this.resumable.assignBrowse(this.uploadInput.current, true);\n    if (this.props.dragAndDrop) {\n      this.resumable.assignDrop(document.getElementById('upload-link-drop-zone'));\n    }\n\n    this.bindCallbackHandler();\n    this.bindEventHandler();\n  }\n\n  componentWillUnmount = () => {\n    window.onbeforeunload = null;\n    if (this.props.dragAndDrop === true) {\n      this.resumable.disableDropOnDocument();\n    }\n  }\n\n  onbeforeunload = () => {\n    if (window.uploader &&\n        window.uploader.isUploadProgressDialogShow &&\n        window.uploader.totalProgress !== 100) {\n      return '';\n    }\n  }\n\n  bindCallbackHandler = () => {\n    let { minFileSizeErrorCallback, fileTypeErrorCallback } = this.props;\n\n    if (this.maxFilesErrorCallback) {\n      this.resumable.opts.maxFilesErrorCallback = this.maxFilesErrorCallback;\n    }\n\n    if (minFileSizeErrorCallback) {\n      this.resumable.opts.minFileSizeErrorCallback = this.props.minFileSizeErrorCallback;\n    }\n\n    if (this.maxFileSizeErrorCallback) {\n      this.resumable.opts.maxFileSizeErrorCallback = this.maxFileSizeErrorCallback;\n    }\n\n    if (fileTypeErrorCallback) {\n      this.resumable.opts.fileTypeErrorCallback = this.props.fileTypeErrorCallback;\n    }\n\n  }\n\n  bindEventHandler = () => {\n    this.resumable.on('chunkingComplete', this.onChunkingComplete.bind(this));\n    this.resumable.on('fileAdded', this.onFileAdded.bind(this));\n    this.resumable.on('fileProgress', this.onFileProgress.bind(this));\n    this.resumable.on('fileSuccess', this.onFileUploadSuccess.bind(this));\n    this.resumable.on('progress', this.onProgress.bind(this));\n    this.resumable.on('complete', this.onComplete.bind(this));\n    this.resumable.on('fileError', this.onFileError.bind(this));\n    this.resumable.on('error', this.onError.bind(this));\n    this.resumable.on('dragstart', this.onDragStart.bind(this));\n  }\n\n  maxFilesErrorCallback = (files, errorCount) => {\n    let maxFiles = maxNumberOfFilesForFileupload;\n    let message = gettext('Please upload no more than {maxFiles} files at a time.');\n    message = message.replace('{maxFiles}', maxFiles);\n    toaster.danger(message);\n  }\n\n  maxFileSizeErrorCallback = (file) => {\n    let { forbidUploadFileList } = this.state;\n    forbidUploadFileList.push(file);\n    this.setState({forbidUploadFileList: forbidUploadFileList});\n  }\n\n  onChunkingComplete = (resumableFile) => {\n\n    let allFilesUploaded = this.state.allFilesUploaded;\n    if (allFilesUploaded === true) {\n      this.setState({allFilesUploaded: false});\n    }\n\n    let path = this.props.path;\n    let fileName = resumableFile.fileName;\n    let relativePath = resumableFile.relativePath;\n    let isFile = fileName === relativePath;\n\n    resumableFile.formData = {};\n    if (isFile) { // upload file\n      resumableFile.formData  = {\n        parent_dir: path,\n      };\n    } else { // upload folder\n      let relative_path = relativePath.slice(0, relativePath.lastIndexOf('/') + 1);\n      resumableFile.formData  = {\n        parent_dir: path,\n        relative_path: relative_path\n      };\n    }\n  }\n\n  onFileAdded = (resumableFile, files) => {\n    let isFile = resumableFile.fileName === resumableFile.relativePath;\n    if (isFile && files.length === 1) {\n      let hasRepetition = false;\n      /*\n      let direntList = this.props.direntList;\n      for (let i = 0; i < direntList.length; i++) {\n        if (direntList[i].type === 'file' && direntList[i].name === resumableFile.fileName) {\n          hasRepetition = true;\n          break;\n        }\n      }\n      */\n      if (hasRepetition) {\n        this.setState({\n          isUploadRemindDialogShow: true,\n          currentResumableFile: resumableFile,\n        });\n      } else {\n        this.setUploadFileList(this.resumable.files);\n        seafileAPI.sharedUploadLinkGetFileUploadUrl(this.props.token).then(res => {\n          this.resumable.opts.target = res.data.upload_link + '?ret-json=1';\n          this.resumableUpload(resumableFile);\n        }).catch(error => {\n          let errMessage = Utils.getErrorMsg(error);\n          toaster.danger(errMessage);\n        });\n      }\n    } else {\n      this.setUploadFileList(this.resumable.files);\n      if (!this.isUploadLinkLoaded) {\n        this.isUploadLinkLoaded = true;\n        seafileAPI.sharedUploadLinkGetFileUploadUrl(this.props.token).then(res => {\n          this.resumable.opts.target = res.data.upload_link + '?ret-json=1';\n          this.resumable.upload();\n        }).catch(error => {\n          let errMessage = Utils.getErrorMsg(error);\n          toaster.danger(errMessage);\n        });\n      }\n    }\n  }\n\n  resumableUpload = (resumableFile) => {\n    let { repoID, path } = this.props;\n    seafileAPI.getFileUploadedBytes(repoID, path, resumableFile.fileName).then(res => {\n      let uploadedBytes = res.data.uploadedBytes;\n      let blockSize = parseInt(resumableUploadFileBlockSize) * 1024 * 1024 || 1024 * 1024;\n      let offset = Math.floor(uploadedBytes / blockSize);\n      resumableFile.markChunksCompleted(offset);\n      this.resumable.upload();\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  }\n\n  filesAddedComplete = (resumable, files) => {\n    let { forbidUploadFileList } = this.state;\n    if (forbidUploadFileList.length > 0 && files.length === 0) {\n      this.setState({\n        isUploadProgressDialogShow: true,\n        totalProgress: 100\n      });\n    }\n  }\n\n  setUploadFileList = () => {\n    let uploadFileList = this.resumable.files;\n    this.setState({\n      uploadFileList: uploadFileList,\n      isUploadProgressDialogShow: true,\n    });\n    Utils.registerGlobalVariable('uploader', 'isUploadProgressDialogShow', true);\n  }\n\n  onFileProgress = (resumableFile) => {\n    let uploadBitrate = this.getBitrate();\n    let uploadFileList = this.state.uploadFileList.map(item => {\n      if (item.uniqueIdentifier === resumableFile.uniqueIdentifier) {\n        if (uploadBitrate) {\n          let lastSize = (item.size - (item.size * item.progress())) * 8;\n          let time = Math.floor(lastSize / uploadBitrate);\n          item.remainingTime = time;\n        }\n      }\n      return item;\n    });\n\n    this.setState({\n      uploadBitrate: uploadBitrate,\n      uploadFileList: uploadFileList\n    });\n  }\n\n  getBitrate = () => {\n    let loaded = 0;\n    let uploadBitrate = 0;\n    let now = new Date().getTime();\n\n    this.resumable.files.forEach(file => {\n      loaded += file.progress() * file.size;\n    });\n\n    if (this.timestamp) {\n      let timeDiff = (now - this.timestamp);\n      if (timeDiff < this.bitrateInterval) {\n        return this.state.uploadBitrate;\n      }\n\n      // 1. Cancel will produce loaded greater than this.loaded\n      // 2. reset can make this.loaded to be 0\n      if (loaded < this.loaded || this.loaded === 0) {\n        this.loaded = loaded; //\n      }\n\n      uploadBitrate = (loaded - this.loaded) * (1000 / timeDiff) * 8;\n    }\n\n    this.timestamp = now;\n    this.loaded = loaded;\n\n    return uploadBitrate;\n  }\n\n  onProgress = () => {\n    let progress = Math.round(this.resumable.progress() * 100);\n    this.setState({totalProgress: progress});\n    Utils.registerGlobalVariable('uploader', 'totalProgress', progress);\n  }\n\n  onFileUploadSuccess = (resumableFile, message) => {\n    let formData = resumableFile.formData;\n    let currentTime = new Date().getTime()/1000;\n    message = formData.replace ? message : JSON.parse(message)[0];\n    if (formData.relative_path) { // upload folder\n      let relative_path = formData.relative_path;\n      let dir_name = relative_path.slice(0, relative_path.indexOf('/'));\n      let dirent = {\n        id: message.id,\n        name: dir_name,\n        type: 'dir',\n        mtime: currentTime,\n      };\n\n      // update folders cache\n      let isExist = this.notifiedFolders.some(item => {return item.name === dirent.name;});\n      if (!isExist) {\n        this.notifiedFolders.push(dirent);\n        this.props.onFileUploadSuccess(dirent);\n      }\n\n      // update uploadFileList\n      let uploadFileList = this.state.uploadFileList.map(item => {\n        if (item.uniqueIdentifier === resumableFile.uniqueIdentifier) {\n          item.newFileName = relative_path + message.name;\n          item.isSaved = true;\n        }\n        return item;\n      });\n      this.setState({uploadFileList: uploadFileList});\n\n      return;\n    }\n\n    if (formData.replace) { // upload file -- replace exist file\n      let fileName = resumableFile.fileName;\n      let dirent = {\n        id: message,\n        name: fileName,\n        type: 'file',\n        mtime: currentTime\n      };\n      this.props.onFileUploadSuccess(dirent); // this contance: just one file\n\n      let uploadFileList = this.state.uploadFileList.map(item => {\n        if (item.uniqueIdentifier === resumableFile.uniqueIdentifier) {\n          item.newFileName = fileName;\n          item.isSaved = true;\n        }\n        return item;\n      });\n      this.setState({uploadFileList: uploadFileList});\n\n      return;\n    }\n\n    // upload file -- add files\n    let dirent = {\n      id: message.id,\n      type: 'file',\n      name: message.name,\n      size: message.size,\n      mtime: currentTime,\n    };\n    this.props.onFileUploadSuccess(dirent);\n\n    let uploadFileList = this.state.uploadFileList.map(item => {\n      if (item.uniqueIdentifier === resumableFile.uniqueIdentifier) {\n        item.newFileName = message.name;\n        item.isSaved = true;\n      }\n      return item;\n    });\n    this.setState({uploadFileList: uploadFileList});\n  }\n\n  onFileError = (resumableFile, message) => {\n    let error = '';\n    if (!message) {\n      error = gettext('Network error');\n    } else {\n      // eg: '{\"error\": \"Internal error\" \\n }'\n      let errorMessage = message.replace(/\\n/g, '');\n      errorMessage  = JSON.parse(errorMessage);\n      error = errorMessage.error;\n      if (error === 'File locked by others.') {\n        error = gettext('File is locked by others.');\n      }\n      if (error === 'Internal error.') {\n        error = gettext('Internal Server Error');\n      }\n    }\n\n    let uploadFileList = this.state.uploadFileList.map(item => {\n      if (item.uniqueIdentifier === resumableFile.uniqueIdentifier) {\n        this.state.retryFileList.push(item);\n        item.error = error;\n      }\n      return item;\n    });\n\n    this.loaded = 0;  // reset loaded data;\n    this.setState({\n      retryFileList: this.state.retryFileList,\n      uploadFileList: uploadFileList\n    });\n\n  }\n\n  onComplete = () => {\n    this.notifiedFolders = [];\n    // reset upload link loaded\n    this.isUploadLinkLoaded = false;\n    this.setState({allFilesUploaded: true});\n  }\n\n  onError = (message) => {\n    // reset upload link loaded\n    this.isUploadLinkLoaded = false;\n    // After the error, the user can switch windows\n    Utils.registerGlobalVariable('uploader', 'totalProgress', 100);\n  }\n\n  setHeaders = (resumableFile, resumable) => {\n    let offset = resumable.offset;\n    let chunkSize = resumable.getOpt('chunkSize');\n    let fileSize = resumableFile.size === 0 ? 1 : resumableFile.size;\n    let startByte = offset !== 0 ? offset * chunkSize : 0;\n    let endByte = Math.min(fileSize, (offset + 1) * chunkSize) - 1;\n\n    if (fileSize - resumable.endByte < chunkSize && !resumable.getOpt('forceChunkSize')) {\n      endByte = fileSize;\n    }\n\n    let headers = {\n      'Accept': 'application/json; text/javascript, */*; q=0.01',\n      'Content-Disposition': 'attachment; filename=\"' + encodeURI(resumableFile.fileName) + '\"',\n      'Content-Range': 'bytes ' + startByte + '-' + endByte + '/' + fileSize,\n    };\n\n    return headers;\n  }\n\n  setQuery = (resumableFile) => {\n    let formData = resumableFile.formData;\n    return formData;\n  }\n\n  generateUniqueIdentifier = (file) => {\n    let relativePath = file.webkitRelativePath||file.relativePath||file.fileName||file.name;\n    return MD5(relativePath + new Date()) + relativePath;\n  }\n\n  onClick = (e) => {\n    e.nativeEvent.stopImmediatePropagation();\n    e.stopPropagation();\n  }\n\n  onFileUpload = () => {\n    this.uploadInput.current.removeAttribute('webkitdirectory');\n    this.uploadInput.current.click();\n  }\n\n  onFolderUpload = () => {\n    this.uploadInput.current.setAttribute('webkitdirectory', 'webkitdirectory');\n    this.uploadInput.current.click();\n  }\n\n  onDragStart = () => {\n    this.uploadInput.current.setAttribute('webkitdirectory', 'webkitdirectory');\n  }\n\n  onCloseUploadDialog = () => {\n    this.loaded = 0;\n    this.resumable.files = [];\n    // reset upload link loaded\n    this.isUploadLinkLoaded = false;\n    this.setState({isUploadProgressDialogShow: false, uploadFileList: [], forbidUploadFileList: []});\n    Utils.registerGlobalVariable('uploader', 'isUploadProgressDialogShow', false);\n  }\n\n  onUploadCancel = (uploadingItem) => {\n\n    let uploadFileList = this.state.uploadFileList.filter(item => {\n      if (item.uniqueIdentifier === uploadingItem.uniqueIdentifier) {\n        item.cancel(); // execute cancel function will delete the file at the same time\n        return false;\n      }\n      return true;\n    });\n\n    if (!this.resumable.isUploading()) {\n      this.setState({\n        totalProgress: '100',\n        allFilesUploaded: true,\n      });\n      this.loaded = 0;\n    }\n\n    this.setState({uploadFileList: uploadFileList});\n  }\n\n  onCancelAllUploading = () => {\n    let uploadFileList = this.state.uploadFileList.filter(item => {\n      if (Math.round(item.progress() !== 1)) {\n        item.cancel();\n        return false;\n      }\n      return true;\n    });\n\n    this.loaded = 0;\n\n    this.setState({\n      allFilesUploaded: true,\n      totalProgress: '100',\n      uploadFileList: uploadFileList\n    });\n    // reset upload link loaded\n    this.isUploadLinkLoaded = false;\n  }\n\n  onUploadRetry = (resumableFile) => {\n    seafileAPI.sharedUploadLinkGetFileUploadUrl(this.props.token).then(res => {\n      this.resumable.opts.target = res.data.upload_link + '?ret-json=1';\n      let retryFileList = this.state.retryFileList.filter(item => {\n        return item.uniqueIdentifier !== resumableFile.uniqueIdentifier;\n      });\n      let uploadFileList = this.state.uploadFileList.map(item => {\n        if (item.uniqueIdentifier === resumableFile.uniqueIdentifier) {\n          item.error = null;\n          this.retryUploadFile(item);\n        }\n        return item;\n      });\n\n      this.setState({\n        retryFileList: retryFileList,\n        uploadFileList: uploadFileList\n      });\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  }\n\n  retryUploadFile = (resumableFile) => {\n    let { repoID, path } = this.props;\n    let fileName = resumableFile.fileName;\n    let isFile = resumableFile.fileName === resumableFile.relativePath;\n    if (!isFile) {\n      let relative_path = resumableFile.formData.relative_path;\n      let prefix = path === '/' ? (path + relative_path) : (path + '/' + relative_path);\n      fileName = prefix + fileName;\n    }\n\n    resumableFile.bootstrap();\n    var firedRetry = false;\n    resumableFile.resumableObj.on('chunkingComplete', () => {\n      if(!firedRetry) {\n        seafileAPI.getFileUploadedBytes(repoID, path, fileName).then(res => {\n          let uploadedBytes = res.data.uploadedBytes;\n          let blockSize = parseInt(resumableUploadFileBlockSize) * 1024 * 1024 || 1024 * 1024;\n          let offset = Math.floor(uploadedBytes / blockSize);\n          resumableFile.markChunksCompleted(offset);\n\n          resumableFile.resumableObj.upload();\n\n        }).catch(error => {\n          let errMessage = Utils.getErrorMsg(error);\n          toaster.danger(errMessage);\n        });\n      }\n      firedRetry = true;\n    });\n\n  }\n\n  replaceRepetitionFile = () => {\n    let { repoID, path } = this.props;\n    seafileAPI.getUpdateLink(repoID, path).then(res => {\n      this.resumable.opts.target = res.data;\n\n      let resumableFile = this.resumable.files[this.resumable.files.length - 1];\n      resumableFile.formData['replace'] = 1;\n      resumableFile.formData['target_file'] = resumableFile.formData.parent_dir + resumableFile.fileName;\n      this.setUploadFileList(this.resumable.files);\n      this.resumable.upload();\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  }\n\n  cancelFileUpload = () => {\n    this.resumable.files.pop(); //delete latest file；\n  }\n\n  render() {\n    return (\n      <Fragment>\n        <div className=\"file-uploader-container\">\n          <div className=\"file-uploader\">\n            <input className=\"upload-input\" type=\"file\" ref={this.uploadInput} onClick={this.onClick} />\n          </div>\n        </div>\n        <UploadProgressDialog\n          retryFileList={this.state.retryFileList}\n          uploadFileList={this.state.uploadFileList}\n          forbidUploadFileList={this.state.forbidUploadFileList}\n          totalProgress={this.state.totalProgress}\n          uploadBitrate={this.state.uploadBitrate}\n          allFilesUploaded={this.state.allFilesUploaded}\n          onCloseUploadDialog={this.onCloseUploadDialog}\n          onCancelAllUploading={this.onCancelAllUploading}\n          onUploadCancel={this.onUploadCancel}\n          onUploadRetry={this.onUploadRetry}\n          onFileUpload={this.onFileUpload}\n          onFolderUpload={this.onFolderUpload}\n        />\n      </Fragment>\n    );\n  }\n}\n\nFileUploader.propTypes = propTypes;\n\nexport default FileUploader;\n","import React, { Fragment } from 'react';\nimport ReactDOM from 'react-dom';\nimport { Utils } from '../../utils/utils';\nimport { gettext } from '../../utils/constants';\nimport Logo from '../../components/logo';\nimport Account from '../../components/common/account';\nimport FileUploader from './file-uploader';\n\nimport '../../css/upload-link.css';\n\nconst loggedUser = window.app.pageOptions.username;\nconst {\n  dirName,\n  sharedBy,\n  noQuota,\n  maxUploadFileSize,\n  token,\n  repoID,\n  path\n} = window.uploadLink;\n\n\nclass SharedUploadLink extends React.Component {\n\n  render() {\n    return (\n      <div className=\"h-100 d-flex flex-column\">\n        <div className=\"top-header d-flex justify-content-between\">\n          <Logo />\n          {loggedUser && <Account />}\n        </div>\n        <div className=\"o-auto\">\n          <div className=\"py-4 px-6 mx-auto rounded\" id=\"upload-link-panel\">\n            <h3 className=\"h5\" dangerouslySetInnerHTML={{__html: gettext('Upload files to {folder_name_placeholder}')\n              .replace('{folder_name_placeholder}', `<span class=\"op-target\">${Utils.HTMLescape(dirName)}</span>`)}}></h3>\n            <p className=\"small shared-by\" dangerouslySetInnerHTML={{__html: `${gettext('shared by:')} ${sharedBy.avatar} ${sharedBy.name}`}}></p>\n            {noQuota ? (\n              <div className=\"py-6 text-center\">\n                <span className=\"sf3-font sf3-font-tips warning-icon\"></span>\n                <p>{gettext('The owner of this library has run out of space.')}</p>\n              </div>\n            ) : (\n              <Fragment>\n                <ol className=\"small text-gray\">\n                  <li className=\"tip-list-item\">{gettext('Folder upload is limited to Chrome, Firefox 50+, and Microsoft Edge.')}</li>\n                  {maxUploadFileSize && <li className=\"tip-list-item\">{gettext('File size should be smaller than {max_size_placeholder}.').replace('{max_size_placeholder}', maxUploadFileSize)}</li>}\n                </ol>\n                <div id=\"upload-link-drop-zone\" className=\"text-center mt-2 mb-4\">\n                  <span className=\"sf3-font sf3-font-upload upload-icon\"></span>\n                  <p className=\"small text-gray mb-0\">{gettext('Drag and drop files or folders here.')}</p>\n                </div>\n                <FileUploader\n                  ref={uploader => this.uploader = uploader}\n                  dragAndDrop={true}\n                  token={token}\n                  repoID={repoID}\n                  path={path}\n                  onFileUploadSuccess={() => {}}\n                />\n              </Fragment>\n            )}\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nReactDOM.render(\n  <SharedUploadLink />,\n  document.getElementById('wrapper')\n);\n"],"sourceRoot":""}